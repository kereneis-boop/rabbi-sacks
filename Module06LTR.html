<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Living Legacy – Mind-Map (Module 6)</title>
<link href="https://fonts.googleapis.com/css2?family=Alef:wght@400;700&display=swap" rel="stylesheet">
<style>
  /* Define the custom font from edX Assets */
  @font-face {
    font-family: 'Kav16';
    src: url('https://courses.edx.org/asset-v1:IsraelX+Rabi_BIU+1T2026+type@asset+block@Kav16-Regular.woff') format('woff');
    font-weight: normal;
    font-style: normal;
    font-display: swap;
  }

  :root{
    /* Spacing and Gaps - Balanced Margins */
    --zoombar-gap: 30px;
    --map-pad-top: 40px;    
    --map-pad-bottom: 80px; 
    --fit-margin: 30; 

    --gap-between-groups: 50px;
    --gap-x:36px;
    --gap-x-d01:100px;
    --gap-rootcat:22px;
    --gap-cat:22px;
    --gap-d3:18px;
    --gap-d4:18px;
    --gap-item:6px;
    --chip-h:48px;

    /* Theme */
    --font: 'Kav16', 'Alef', system-ui, -apple-system, "Segoe UI", Arial, sans-serif;
    --bg:#ffffff; --ink:#0f172a;
    --edge:#C5CBD8; --toggle:#fe0100;
    --shadow:0 8px 22px rgba(0,0,0,.10);
    --r:9999px;

    /* Animations */
    --anim-dur:.60s;
    --anim-ease:ease-in-out;
  }

  *{box-sizing:border-box}
  html, body, .chip, .zoombar, .zoombar button, .pct, .label { font-family: var(--font) !important; }
  html,body{height:100%; overflow:hidden}
  body{margin:0;background:var(--bg);color:var(--ink); display: flex; flex-direction: column;}
  .wrap{padding:0; width:100%; flex: 1; display: flex; flex-direction: column; overflow: hidden;}

  /* Toolbar */
  .zoombar{
    position:relative; top:8px; 
    display:flex; justify-content:center; align-items:center; gap:6px; z-index:10;
    background:rgba(255,255,255,.9); backdrop-filter:saturate(180%) blur(10px);
    padding:10px 12px; margin:0 auto var(--zoombar-gap);
    width:max-content; border-radius:14px;
    border:1px solid rgba(15,23,42,.06); box-shadow:0 8px 24px rgba(0,0,0,.10);
    flex-shrink: 0;
  }
  .zoombar button{
    border:1px solid rgba(15,23,42,.08); border-radius:12px; height:36px; padding:0 12px; font-weight:800; cursor:pointer;
    background:linear-gradient(180deg,#ffffff,#f7f7f9); box-shadow:0 4px 12px rgba(0,0,0,.08);
    display:inline-flex; align-items:center; justify-content:center; gap:8px;
    transition:transform .12s ease, box-shadow .12s ease, background .12s ease;
    touch-action:manipulation;
  }
  .zoombar button:hover{box-shadow:0 8px 18px rgba(0,0,0,.12)}
  .zoombar button:active{transform:translateY(1px)}
  .zoombar .pct{min-width:68px; height:36px; display:inline-flex; align-items:center; justify-content:center; border-radius:9999px; background:#f3f4f6; border:1px solid rgba(15,23,42,.08)}
  #zoomIn,#zoomOut{width:36px; padding:0; border-radius:9999px}
  #fitW{background:linear-gradient(180deg,#fafafa,#eeeeff);}

  /* Stage and Viewport */
  .viewport{position:relative; width:100%; flex: 1; overflow:auto; touch-action:none; cursor:grab; scrollbar-gutter:stable both-edges; direction:ltr;}
  .viewport.panning{ cursor:grabbing; }
  .scroller{ position:relative; min-width: 100%; min-height: 100%; }
  .stage{ position:absolute; inset-inline-start:0; top:0; transform-origin: 0 0; min-height:10px; min-width:10px; opacity:0 }
  .chips{ position:absolute; inset:0; z-index:1 }
  svg{ position:absolute; inset:0; width:100%; height:100%; overflow:visible; z-index:0 }

  /* Nodes/Chips */
  .chip{
    position:absolute; display:flex; align-items:center;
    height:var(--chip-h); padding:0 16px; border-radius:var(--r);
    line-height:1.2; white-space:nowrap; box-shadow:var(--shadow), inset 0 1px 0 rgba(255,255,255,.6);
    direction:ltr; text-align:left; font-weight:700; gap:14px;
    background: var(--chip-bg, #ffffff); color:#0f172a; cursor:pointer;
  }
  .chip[data-kind="root"]{font-weight:800; font-size:1.1rem}
  .label{pointer-events:none; direction:ltr; text-align:left}
  .chip .toggle{margin-inline-start:auto}
  .toggle{position:relative; width:28px; height:28px; border:0; border-radius:50%; background:var(--toggle); cursor:pointer; flex-shrink:0;}
  .toggle .bar{position:absolute; left:50%; top:50%; width:14px; height:2px; background:#fff; border-radius:2px; transform:translate(-50%,-50%); transition:opacity var(--anim-dur) var(--anim-ease)}
  .toggle .bar.v{transform:translate(-50%,-50%) rotate(90deg)}
  .chip[aria-expanded="true"] .toggle .bar.v{opacity:0}

  .edge{fill:none; stroke:var(--edge); stroke-width:2; stroke-linecap:round}

  /* Fade animations */
  .fade-exit{ opacity:1 }
  .fade-exit.fade-active{ opacity:0; transition: opacity var(--anim-dur) var(--anim-ease) }

  @media (max-width: 600px) {
    .chip { white-space: normal; height: auto; min-height: var(--chip-h); padding: 8px 16px; width: 220px; }
  }
</style>
</head>
<body>
<div class="wrap">
  <div class="zoombar" aria-label="Zoom controls">
    <button id="fitW" title="Fit to view">↔︎ Fit</button>
    <button id="zoomOut" title="Zoom out">−</button>
    <button id="zoomPct" class="pct" title="100%">100%</button>
    <button id="zoomIn" title="Zoom in">+</button>
    <button id="expandAll" title="Expand all">Expand all</button>
    <button id="collapseAll" title="Collapse all">Collapse all</button>
  </div>

  <div id="viewport" class="viewport">
    <div id="scroller" class="scroller">
      <div id="app" class="stage">
        <svg id="edges" aria-hidden="true"></svg>
        <div id="chips" class="chips"></div>
      </div>
    </div>
  </div>
</div>

<script id="mindmap-data" type="application/json">
{
  "dir": "ltr",
  "flow": "ltr",
  "root": {
    "label": "Living Legacy",
    "children": [
      {
        "label": "Lesson #01 – The Thought of Rabbi Sacks: Between Public Memory and Inspiration",
        "children": [
          { "label": "Examine the ways in which Rabbi Sacks’s legacy continues to shape contemporary discourse." },
          { "label": "Analyze the dialogue between public memory and the principles of inspiration." },
          { "label": "Assess Rabbi Sacks’s contribution to shaping Jewish moral identity globally." },
          { "label": "Examine educational ideas in institutions such as the Sacks Morasha School." },
          { "label": "Relate the meaning of ‘religion as a moral–social force’ within his thought." }
        ]
      },
      {
        "label": "Lesson #02 – Adam Ferziger: A Cultural Phenomenon in Israel",
        "children": [
          { "label": "Examine the process in which Rabbi Sacks’s thought has been absorbed into Israeli discourse." },
          { "label": "Analyze the cultural impact of translating his writings for a secular–academic audience." },
          { "label": "Explore the bridge between modern Orthodoxy and universal moral discourse." },
          { "label": "Identify him as a model of the contemporary public intellectual." },
          { "label": "Discuss his contribution to shaping a modern Jewish moral identity." }
        ]
      },
      {
        "label": "Lesson #03 – Daniel Epstein: From Quotes to the Bookshelf",
        "children": [
          { "label": "Examine how his thought has evolved into a living communal legacy." },
          { "label": "Analyze the influence of his ethical language on community and institutions." },
          { "label": "Explain how his interpretive approach encourages participatory communal discourse." },
          { "label": "Identify the shift from charismatic leadership to a collective moral legacy." },
          { "label": "Discuss the process through which an idea becomes a public ethos." }
        ]
      },
      {
        "label": "Lesson #04 – Chaim Neria: The Archive as Foundation",
        "children": [
          { "label": "Examine the archive as a source for understanding the development of his thought." },
          { "label": "Analyze how manuscripts and drafts reveal his process of thinking and writing." },
          { "label": "Relate the importance of documentary preservation to a ‘living intellectual legacy.’" },
          { "label": "Identify the relationship between text, memory, and community in his thought." },
          { "label": "Discuss the role of cultural memory in shaping renewed moral identity." }
        ]
      },
      {
        "label": "Lesson #05 – Joanna Benarroch: Challenges of Modernity",
        "children": [
          { "label": "Analyze his concept of public responsibility in relation to modernity." },
          { "label": "Examine how he offers a model for moral living in a global-religious world." },
          { "label": "Connect the concept of a ‘community of responsibility’ to educational contexts." },
          { "label": "Identify the role of education in transmitting values across generations." },
          { "label": "Discuss the tension between universal openness and preserving distinctiveness." }
        ]
      },
      {
        "label": "Lesson #06 – Joanne Greenaway: Educational Legacy",
        "children": [
          { "label": "Examine the role of education as a central driving force in his legacy." },
          { "label": "Analyze his influence on shaping moral-educational leadership globally." },
          { "label": "Connect the principle of ‘leadership that creates leaders’ to communal models." },
          { "label": "Identify how educational institutions implement his vision today." },
          { "label": "Discuss the concept of ‘education as a moral mission’ in his legacy." }
        ]
      },
      {
        "label": "Lesson #07 – Radical Then, Radical Now",
        "children": [
          { "label": "Analyze the concept of radicalism in his thought as a deep moral stance." },
          { "label": "Explore how he challenges the spirit of the age while remaining faithful." },
          { "label": "Examine the idea of ‘faith as moral courage’ in a contemporary context." },
          { "label": "Identify the tension between moral conservatism and ethical renewal." },
          { "label": "Discuss the call for social–moral action in an age of change." }
        ]
      }
    ]
  }
}
</script>

<script>
(function(){
  let data;
  try{ data = JSON.parse(document.getElementById('mindmap-data').textContent); }
  catch(e){ data = {"dir":"ltr","flow":"ltr","root":{"label":"Data Error","children":[]}}; }

  const viewport  = document.getElementById('viewport');
  const scroller  = document.getElementById('scroller');
  const stage      = document.getElementById('app');
  const chipLayer = document.getElementById('chips');
  const edgeLayer = document.getElementById('edges');

  let mode='fitW', userScale=1, lockedFit=1, zoomFrozen=false, didInitialFitAll=false;

  const CSS = getComputedStyle(document.documentElement);
  const CHIP_H    = parseFloat(CSS.getPropertyValue('--chip-h'))    || 48;
  const GAP_X     = parseFloat(CSS.getPropertyValue('--gap-x'))     || 36;
  const GAP_ROOTCAT = parseFloat(CSS.getPropertyValue('--gap-rootcat')) || 22;
  const GAP_CAT = parseFloat(CSS.getPropertyValue('--gap-cat'))  || 22;
  const GAP_X_D01 = parseFloat(CSS.getPropertyValue('--gap-x-d01')) || GAP_X;
  const GAP_GROUPS = parseFloat(CSS.getPropertyValue('--gap-between-groups')) || 45;
  
  const FIT_MARGIN = parseFloat(CSS.getPropertyValue('--fit-margin')) || 30;
  const MAP_PAD_TOP = parseFloat(CSS.getPropertyValue('--map-pad-top')) || 40;
  const MAP_PAD_BOTTOM = parseFloat(CSS.getPropertyValue('--map-pad-bottom')) || 80;

  const DEPTH_COLORS = {0:'#F8E8FF', 1:'#EBDCF8', 2:'#D4D2E6', 3:'#D7F6E4', 4:'#50E38A'};

  function build(raw, depth=0, parent=null, idx=0){
    const node = {
      label: raw.label, depth, parent, idx,
      // Lessons (depth 1+) are collapsed by default in the initial state
      collapsed: (depth !== 0),
      x:0,y:0,width:0,height:CHIP_H, el:null, id: Math.random().toString(36).slice(2),
      _subH:0, children: [], gapOverride: (typeof raw.gap==='number'? raw.gap : null)
    };
    (raw.children||[]).forEach((ch,i)=> node.children.push(build(ch, depth+1, node, i)));
    return node;
  }
  const root = build(data.root, 0, null);

  function ensureChip(node){
    if(node.el) return;
    const el = document.createElement('div'); el.className='chip';
    el.dataset.kind = node.depth===0 ? 'root' : (node.children.length? 'cat':'leaf');
    const label = document.createElement('span'); label.className='label'; label.textContent=node.label; el.appendChild(label);
    if(node.children.length){
      const t = document.createElement('button');
      t.className='toggle'; t.type='button'; t.innerHTML = '<i class="bar h"></i><i class="bar v"></i>';
      el.appendChild(t);
      el.setAttribute('aria-expanded', String(!node.collapsed));
      t.addEventListener('click', ev=>{ ev.stopPropagation(); handleToggle(node); });
      el.addEventListener('click', ev=>{ if(ev.target.closest('.toggle')) return; handleToggle(node); });
    }
    el.style.setProperty('--chip-bg', DEPTH_COLORS[Math.min(node.depth,4)] || DEPTH_COLORS[4]);
    chipLayer.appendChild(el); node.el=el;
  }
  (function collect(n){ ensureChip(n); n.children.forEach(collect); })(root);

  function measureNode(node){
    // Node must be temporarily layout-able to get accurate offsetWidth
    const oldDisplay = node.el.style.display;
    node.el.style.display = 'flex';
    node.el.style.visibility = 'hidden';
    node.el.style.position = 'absolute';
    node.el.style.left = '-10000px';
    
    node.width = Math.max(10, node.el.offsetWidth);
    node.height = Math.max(CHIP_H, node.el.offsetHeight);
    
    node.el.style.display = oldDisplay;
    node.el.style.visibility = '';
    node.children.forEach(measureNode);
  }
  
  function gapForDepth(depth){
    if(depth>=4) return 18;
    if(depth===3) return 18;
    if(depth===2) return GAP_CAT;
    if(depth===1) return GAP_ROOTCAT;
    return 20;
  }
  
  function subHeight(node){
    if(node.collapsed || node.children.length===0){ node._subH = node.height; return node._subH; }
    let total = 0;
    node.children.forEach((c,i)=>{
      subHeight(c); total += c._subH;
      if(i>0) total += (node.gapOverride != null) ? node.gapOverride : gapForDepth(c.depth);
      if(node.depth===0 && i<node.children.length-1) total += GAP_GROUPS;
    });
    node._subH = Math.max(node.height, total); return node._subH;
  }

  let DEPTH_ANCHORS = new Map();
  function xForDepth(depth){ return DEPTH_ANCHORS.get(depth) || 0; }
  
  function position(node, depth, top){
    node.x = xForDepth(depth); node.y = top + node._subH/2;
    if(!(node.collapsed) && node.children.length){
      let cursor = top;
      node.children.forEach((c,i)=>{
        position(c, depth+1, cursor);
        cursor += c._subH + gapForDepth(c.depth);
        if(node.depth===0 && i<node.children.length-1) cursor += GAP_GROUPS;
      });
    }
  }
  
  function collectVisible(n, arr){ arr.push(n); if(!n.collapsed) n.children.forEach(ch=>collectVisible(ch, arr)); }
  
  function computeBounds(nodes){
    let minX=Infinity,maxX=-Infinity,minY=Infinity,maxY=-Infinity;
    nodes.forEach(n=>{
      minX = Math.min(minX, n.x); 
      maxX = Math.max(maxX, n.x + n.width);
      minY = Math.min(minY, n.y - n.height/2); 
      maxY = Math.max(maxY, n.y + n.height/2);
    });
    return { w:(maxX-minX), h:(maxY-minY), minX, minY, maxX, maxY };
  }

  let lastW=0, lastH=0, offsetX=0, offsetY=0;

  function layout(){
    measureNode(root);
    subHeight(root); position(root,0,0);
    
    const visibleNodes = [];
    collectVisible(root, visibleNodes);

    // Dynamic depth anchors
    const depthMaxW = new Map();
    visibleNodes.forEach(n=>{ depthMaxW.set(n.depth, Math.max(depthMaxW.get(n.depth)||0, n.width));});

    DEPTH_ANCHORS = new Map(); DEPTH_ANCHORS.set(0, 0);
    let acc=0;
    const maxDepthVis = visibleNodes.reduce((m,n)=>Math.max(m,n.depth),0);
    for(let d=1; d<=maxDepthVis+1; d++){
      acc += (depthMaxW.get(d-1)||140) + (d===1 ? GAP_X_D01 : GAP_X);
      DEPTH_ANCHORS.set(d, acc);
    }

    subHeight(root); position(root, 0, 0);
    const nodes=[]; collectVisible(root, nodes);
    const bounds = computeBounds(nodes);

    const vpW = viewport.clientWidth;
    const vpH = viewport.clientHeight;

    const innerW = Math.max(1, vpW - FIT_MARGIN * 2);
    const innerH = Math.max(1, vpH - (MAP_PAD_TOP + MAP_PAD_BOTTOM));

    const fitW_scale = innerW / Math.max(1, bounds.w);
    const fitH_scale = innerH / Math.max(1, bounds.h);
    const baseFit = Math.min(fitW_scale, fitH_scale);

    lockedFit = baseFit;

    if (!zoomFrozen){ 
        userScale = lockedFit; 
        mode = 'fitW';
        zoomFrozen = true; 
    }

    const sNow = (mode==='fitW') ? lockedFit : userScale;

    // Centering and Margin Calculation
    offsetX = -bounds.minX + Math.max(FIT_MARGIN, (vpW / sNow - bounds.w) / 2);
    offsetY = -bounds.minY + Math.max(MAP_PAD_TOP, (vpH / sNow - bounds.h) / 2);
    
    // Total stage dimensions
    const stageW = bounds.maxX + offsetX + FIT_MARGIN;
    const stageH = bounds.maxY + offsetY + MAP_PAD_BOTTOM;

    stage.style.width = Math.ceil(stageW) + 'px';
    stage.style.height = Math.ceil(stageH) + 'px';

    (function hideAll(n){ if(n.el) n.el.style.display='none'; n.children.forEach(hideAll); })(root);

    nodes.forEach(n=>{
      n.el.style.display = 'flex';
      const top = (n.y - n.height/2) + offsetY;
      const xUnits = offsetX + n.x;
      n.el.style.left  = xUnits + 'px';
      n.el.style.top   = top + 'px';
      if(n.children.length) n.el.setAttribute('aria-expanded', String(!n.collapsed));
      n.el.classList.remove('fade-exit', 'fade-active');
    });

    edgeLayer.textContent='';
    (function draw(n){ if(n.collapsed) return; n.children.forEach(ch=>{
      const y1 = n.y + offsetY;
      const y2 = ch.y + offsetY;
      const p1x = (offsetX + n.x + n.width) - 6; 
      const p2x = (offsetX + ch.x) + 6;
      const dx = Math.abs(p2x-p1x) * 0.45;
      const path = document.createElementNS('http://www.w3.org/2000/svg','path');
      path.setAttribute('class','edge');
      path.setAttribute('d', `M ${p1x} ${y1} C ${p1x+dx} ${y1}, ${p2x-dx} ${y2}, ${p2x} ${y2}`);
      edgeLayer.appendChild(path);
      draw(ch);
    }); })(root);

    lastW = stageW; lastH = stageH;
    applyZoom(); stage.style.opacity='1';
  }

  function handleToggle(n){
    if(!n.children.length) return;
    if(mode === 'fitW') { userScale = lockedFit; mode = 'free'; }

    if(n.collapsed){ n.collapsed=false; layout(); }
    else {
      const dur = parseFloat(CSS.getPropertyValue('--anim-dur'))*1000;
      n.children.forEach(function collect(node){
        if(!node || node.collapsed) return;
        if(node.el) {
          node.el.classList.add('fade-exit');
          requestAnimationFrame(()=> node.el.classList.add('fade-active'));
        }
        node.children.forEach(collect);
      });
      setTimeout(()=> {
        (function close(node){ node.collapsed=true; node.children.forEach(close); })(n);
        layout();
      }, dur);
    }
  }

  function applyZoom(){
    const s = (mode==='fitW') ? lockedFit : userScale;
    stage.style.transform = `scale(${s})`;
    document.getElementById('zoomPct').textContent = Math.round(s*100) + "%";
    
    const sw = Math.ceil(lastW * s);
    const sh = Math.ceil(lastH * s);
    
    scroller.style.width = Math.max(viewport.clientWidth, sw) + 'px';
    scroller.style.height = Math.max(viewport.clientHeight, sh) + 'px';
  }

  let isDown=false, isPanning=false, panStartX=0, panStartY=0, startL=0, startT=0, activeId=null;
  viewport.addEventListener('pointerdown', e=>{
    if(mode==='fitW') return;
    isDown=true; activeId=e.pointerId; panStartX=e.clientX; panStartY=e.clientY;
    startL=viewport.scrollLeft; startT=viewport.scrollTop;
  });
  window.addEventListener('pointermove', e=>{
    if(!isDown || e.pointerId!==activeId) return;
    const dx=e.clientX-panStartX, dy=e.clientY-panStartY;
    if(!isPanning && Math.hypot(dx,dy)>5){ isPanning=true; viewport.classList.add('panning'); viewport.setPointerCapture(activeId); }
    if(isPanning){ viewport.scrollLeft=startL-dx; viewport.scrollTop=startT-dy; }
  });
  window.addEventListener('pointerup', e=>{
    if(e.pointerId!==activeId) return;
    isDown=false; isPanning=false; viewport.classList.remove('panning');
  });

  function bind(id, fn){ document.getElementById(id).onclick=fn; }
  bind('zoomIn', ()=>{ mode='free'; userScale=Math.min(userScale+0.15, 3); applyZoom(); });
  bind('zoomOut',()=>{ mode='free'; userScale=Math.max(userScale-0.15, 0.2); applyZoom(); });
  bind('zoomPct',()=>{ mode='free'; userScale=1; applyZoom(); });
  bind('fitW',   ()=>{ mode='fitW'; layout(); });
  bind('expandAll', ()=>{ mode='free'; (function op(n){ n.collapsed=false; n.children.forEach(op); })(root); layout(); });
  bind('collapseAll',()=>{ mode='free'; (function cl(n){ if(n!==root) n.collapsed=true; n.children.forEach(cl); })(root); mode='free'; layout(); });

  if (document.fonts && document.fonts.ready) {
    document.fonts.ready.then(()=>{ layout(); });
  }

  window.onresize = layout;
  window.onload = layout;
})();
</script>
</body>
</html>
